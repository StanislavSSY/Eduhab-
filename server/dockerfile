FROM node:20-alpine3.17
# Указываем образ из dockerhub на основе которого будет работать наш образ

WORKDIR /server/
# Указываем корневую директорию, первый / значит, что это абсолютный путь, а не относительный

COPY package*.json /server/
# Копируем package.json в папку сервера /server/, * нужна, если файлы могут быть видоизменёнными

RUN npm install
# устанавливаем зависимости

COPY . /server/
# копируем остальные файлы ("." корень папки) сервера в образ, node_modules тоже будут копироваться, так не надо 

EXPOSE 3100
# Слушаем порт

COPY ./startup.sh /server/
# Копируем скрипт запуска в контейнер (откуда и куда)

RUN chmod +x /server/startup.sh
# добавляем разрешение на выполнение команды из startup.sh для всех пользователей к существующим разрешениям

ENTRYPOINT [ "sh", "/server/startup.sh" ]
# указываем точку входа, запуская файл с командами терминала

# docker build -t server:1.0 ./
# docker run --name server -d -p 3100:3100 --rm server:1.0